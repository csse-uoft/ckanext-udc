{% set current_lang = request.environ.CKAN_LANG %}
{% set locales = h.get_available_locales() %}
{% if locales|length > 1 %}
{# We need react to load the style as well, thus do not put the styles in the css assets #}
<style>
  .udc-lang-form {
    max-width: 240px;
    margin: 0;
    display: inline-block;
  }

  .udc-lang-shell {
    display: flex;
    align-items: baseline;
    gap: 0.4rem;
    padding: 0.25rem 0.85rem;
    position: relative;
    transition:
      border-color 0.18s ease,
      background 0.18s ease,
      box-shadow 0.18s ease;
  }

  .udc-lang-shell:focus-within {
    border-color: rgba(255, 255, 255, 0.95);
    background: rgba(15, 23, 42, 1);
    box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.5);
  }

  .udc-lang-shell i {
    color: rgba(255, 255, 255, 0.9);
    font-size: 0.95rem;
    flex-shrink: 0;
  }

  /* Opt in to customizable select */
  .udc-lang-select,
  .udc-lang-select::picker(select) {
    appearance: base-select;
  }

  .udc-lang-select {
    border: none;
    background: transparent;
    color: #ffffff;
    font-size: 0.9rem;
    font-weight: 500;
    cursor: pointer;
    padding: 0;
    padding-right: 1.6rem; /* space for arrow */
  }

  .udc-lang-select:focus-visible {
    outline: none;
  }

  .udc-lang-select:open {
    color: #e5e7eb;
  }

  /* Dropdown arrow */
  .udc-lang-select::picker-icon {
    content: "\f0d7";
    font-family: "Font Awesome 5 Free";
    font-weight: 900;
    font-size: 0.8rem;
    color: rgba(255, 255, 255, 0.9);
    position: absolute;
    right: 0.8rem;
    pointer-events: none;
    transition: transform 0.18s ease;
  }

  .udc-lang-select:open::picker-icon {
    transform: rotate(180deg);
  }

  /* Picker panel */
  .udc-lang-select::picker(select) {
    border-radius: 10px;
    padding: 0.25rem;
    border: 1px solid rgba(15, 23, 42, 0.9);
    background: #0f172a;
    box-shadow: 0 10px 25px rgba(15, 23, 42, 0.55);
  }

  /* Options */
  .udc-lang-select option {
    display: flex;
    align-items: center;
    padding: 0.4rem 0.75rem;
    border-radius: 6px;
    border: 0;
    background: transparent;
    color: #e5e7eb;
    font-size: 0.9rem;
    cursor: pointer;
    transition:
      background 0.12s ease,
      color 0.12s ease;
  }

  .udc-lang-select option:nth-of-type(odd) {
    background: rgba(15, 23, 42, 0.8);
  }

  .udc-lang-select option:nth-of-type(even) {
    background: rgba(15, 23, 42, 0.6);
  }

  .udc-lang-select option:hover,
  .udc-lang-select option:focus {
    background: rgba(129, 140, 248, 0.35);
    color: #f9fafb;
  }

  .udc-lang-select option:checked {
    background: rgba(129, 140, 248, 0.7);
    color: #f9fafb;
  }

  .udc-lang-select option::checkmark {
    margin-left: auto;
  }

  @media (hover: hover) {
    .udc-lang-shell:hover {
      border-color: rgba(255, 255, 255, 0.9);
      background: rgba(15, 23, 42, 1);
    }
  }
</style>

<form class="udc-lang-form" action="{% url_for 'util.internal_redirect' %}" method="POST">
  {{ h.csrf_input() }}
  <div class="udc-lang-shell">
    <i class="fa fa-globe" aria-hidden="true"></i>
    <select
      id="udc-lang-select"
      name="url"
      class="udc-lang-select"
      aria-label="{{ _('Language') }}"
      onchange="this.form.submit()"
    >
      {% for locale in locales %}
        <option
          value="{% url_for h.current_url(), locale=locale.short_name %}"
          {% if locale.short_name == current_lang %}selected="selected"{% endif %}
        >
          {{ locale.display_name or locale.english_name }}
        </option>
      {% endfor %}
    </select>
  </div>
</form>
{% endif %}
